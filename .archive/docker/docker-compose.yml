version: "3.9"

services:
  # ShepLang CLI - for running ShepLang commands
  sheplang-cli:
    build:
      context: .
      dockerfile: Dockerfile
      target: cli
    image: sheplang-cli:latest
    stdin_open: true
    tty: true
    working_dir: /app
    volumes:
      # Mount current directory for file operations
      - ./examples:/app/examples:ro
    command: ["--help"]

  # ShepKit IDE - browser-based development environment
  shepkit:
    build:
      context: .
      dockerfile: sheplang/shepkit/Dockerfile
    image: shepkit:latest
    ports:
      - "3000:3000"
    environment:
      NODE_ENV: production
      # Add your API keys here or via .env file
      # OPENAI_API_KEY: ${OPENAI_API_KEY}
      # VERCEL_TOKEN: ${VERCEL_TOKEN}
      # NEXT_PUBLIC_SUPABASE_URL: ${NEXT_PUBLIC_SUPABASE_URL}
      # NEXT_PUBLIC_SUPABASE_ANON_KEY: ${NEXT_PUBLIC_SUPABASE_ANON_KEY}
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Development mode with hot reload
  shepkit-dev:
    build:
      context: .
      dockerfile: sheplang/shepkit/Dockerfile
      target: builder
    image: shepkit-dev:latest
    ports:
      - "3000:3000"
    volumes:
      - ./sheplang/shepkit:/app/sheplang/shepkit
      - /app/sheplang/shepkit/node_modules
      - /app/sheplang/shepkit/.next
    working_dir: /app/sheplang/shepkit
    command: ["pnpm", "dev"]
    environment:
      NODE_ENV: development
